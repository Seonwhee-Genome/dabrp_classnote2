---
title: "모델 적용을 위한 전처리"
author: "박찬엽"
date: "2017년 7월 19일"
output:
  ioslides_presentation:
    widescreen: true
    self_contained: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = T)

```

## 목차

  - 전처리를 위한 사전 지식
      - 자료형
      - 변수와 함수
  - 모델을 위한 전처리
      - 문제 해결이란
      - 회귀 모델
      - 군집 알고리즘
      - 연관 분석


## 과제 확인

[예시 코드](https://github.com/mrchypark/dabrp_classnote2/blob/master/assign4.R)

# 전처리를 위한 사전 지식

## 자료형

R은 기본 자료형과 벡터, 리스트, 서드파티 자료형을 가지고 있습니다.

![](https://yuml.me/ee0bc27f)

## 기본 자료형

  - 논리형: TRUE / FALSE
  - 실수형: 숫자 자료형이며 소수점 이하값을 포함하는 형태
  - 정수형: 숫자 자료형 소수점 이하가 없음
  - 문자형: 글자 자료형이며 `"` 또는 `'`로 감싸서 표현
  - 기타: 복소수나 원시형 등

## 논리형

R에서 논리형은 `logical`이라고 표현하고, 모두 대문자인 `TRUE`와 `FALSE`가 각각의 의미를 지닙니다. 약어로써 `T`와 `F` 또한 사용합니다.

##

```{r}
TRUE; F
(x<-T)
class(x)
```

## 실수형

R에서 실수형은 `numeric`이라고 표현하고, 기본으로 동작하는 숫자 자료형입니다. `num`이라고 줄여서 작성하기도 합니다. 다른 언어에서는 `float`이나 `double`이라고도 합니다.

##

```{r}
1; (x<-1)
class(x)
(y<-1.4)
class(y)
```

## 정수형

R에서 정수형은 `integer`이라고 표현하고, 특별히 정수 숫자 뒤에 `L`을 함께 작성함으로써 정수형임을 표현합니다. `int`이라고 줄여서 작성하기도 합니다.

```{r}
class(1)
class(1L)
```

## 문자형

R에서 문자형은 `character`이라고 표현하고, `"`나 `'`로 감싸서 다른 객체와 구분하여 표현합니다. `chr`이나 `char`라고 줄여서 작성하기도 합니다. 

##

`logical`글자와 같은 모양의 `character`를 확인하세요.

```{r}
class(TRUE)
class("TRUE")
```

##

함수와 같은 모양의 `character`를 확인하세요.

```{r}
class(mean)
class("mean")
```

##

데이터 객체와 같은 모양의 `character`를 확인하세요.

```{r}
x<-data.frame(1)
class(x)
class("x")
```

## 배열

배열이란 기본 자료형의 집합입니다. 배열은 연산의 효율을 위하서 만들기 때문에 같은 기본 자료형을 쓰도록 강제하고 있습니다. 몇 `차원`이냐에 따라 특별한 이름이 있기도 합니다.

  - 1D array: 벡터(vector)
  - 2D array: 트릭스(matrix)
  
## 벡터

벡터는 1차원 배열과 같습니다. 보통 `c()`함수로 만들어 집니다. 숫자의 연속인 형태의 벡터는 `from:to` 양식으로 만들기도 합니다. 데이터가 1개인 경우도 벡터이기 때문에 자료형을 확인하기 위해서 `class`나 `is.vector`를 사용할 때 의식하고 있어야 합니다. `[]`를 이용하여 일부만 가져올 수 있습니다.

##

```{r}
class(c(1,2,3,4))
class(1:4)
is.vector(1:4)
is.vector(1)
```

## 매트릭스

매트릭스는 2차원 배열로 사람이 가장 익숙한 자료형이며 `matrix()`함수로 만들 수 있습니다. 1차원의 벡터를 2차원으로 제한한 형태라고 할 수 있습니다. 그렇기 때문에 방향에 따라 벡터의 `subset`문법도 사용할 수 있습니다. 차원은 `,`로 구분합니다.

```{r}
(x<-matrix(1:6, nrow=2))
x[1,2]
x[3]
```

##

`벡터`와 `메트릭스`는 각 위치의 문법을 표시해주기도 합니다.

```{r}
x<-matrix(1:6, nrow=2)
x[1,]
x[,3]
```

## 리스트

`리스트`는 여러 테이블을 가진 하나의 데이터베이스와 비슷합니다. 여러 독립적인 벡터들을 모아놓은 자료형을 `리스트`라고 합니다. 독립적이기 때문에 리스트 내에서 자료형이나 데이터의 길이가 같을 필요가 없습니다.

```{r}
(x<-list(1:6, c(T,F),"play",list(c("A","b"))))
```

##

`리스트` 안에 `리스트`를 가질 수도 있습니다.

```{r}
x<-list(1:6, c(T,F),"play",list(c("A","b")))
str(x)
```

## 

`리스트`는 대괄호를 두 개(`[[`, `]]`) 사용함으로써 `벡터`와 구분하여 `subset`을 합니다. 각 리스트의 이름이 있으면 `데이터$리스트의이름` 형태로 사용할 수도 있습니다.

```{r}
x<-list(num=1:6, c(T,F),"play",list(c("A","b")))
x[[1]]
x$num
```

## 데이터프레임

`데이터프레임`은 앞서 확인한 `리스트`가 너무 자유도가 높아 사용하기 불편한 점을 개선하기 위해 기능을 제한한 `리스트`라고 할 수 있습니다. `리스트`내의 각 `리스트`함를 구성하는 `벡터`로 `컬럼`을 구성하고 길이가 같아야 합니다.

  - 각 `컬럼`은 `벡터`로 구성
    * 다른 자료형은 사용하지 못함
  - `컬럼`의 길이가 모두 같아야 함
  - subset은 메트릭스와 같이 `[`를 1개만 사용
  - 리스트와 같이 `$`을 사용하나 `[`를 2개를 사용하지 않음

## 

`data.frame`으로 데이터를 만듭니다.

```{r}

(x<-data.frame(A=1:3,b=letters[1:3],c=c(T,F,T),d="play"))

```

## 변수와 함수

`R`은 전부 객체로 메모리에 저장합니다. 객체로 저장하여 활용하는 대표적인 예가 `변수`와 `함수`인데 `변수`는 데이터 혹은 데이터의 이름을 뜻합니다.

`함수`는 특별한 형태의 `변수`인데, 코드의 묶음을 데이터로 보고 특별한 문법 `()`을 사용함으로써 내부의 코드를 실행하는 형태로 사용할 수 있습니다.

![](http://yuml.me/2d639c3d)

## 함수

함수는 `()` 안에 사용하는 `인자`를 정의하고 정의된 대로 사용해야 합니다. 괄호 안에는 필수와 필수가 아닌 인자들이 있고 필수가 아닌 인자들은 기본값을 가집니다.

필수인자가 없는 함수도 있고, 많은 것도 있으며 함수를 만든 사람마다 규칙이 다르기도 합니다.

  - `?함수이름` : 함수의 설명을 보여줍니다.
  - `함수이름` : 함수의 코드 구성을 직접 출력합니다.
  - `함수이름()` : 함수의 기능을 동작하게 합니다.

# 모델을 위한 전처리

## 문제 해결이란

통계 분석이나 기계학습은 문제를 `정의`하고, 데이터를 기반으로 `해결책`을 찾고, `결과`를 공유하는 과정을 거칩니다.     

해결책을 찾는 과정에서 적절한 `데이터`를 구하고, 문제에 적합한 알고리즘을 선정하거나 개발하여 `모델`로써 학습하고, 학습한 결과를 `평가`함으로써 결과를 검증하는 3단계를 계속적으로 수행합니다.     

보통은 데이터를 구하고 정제하는데 많은 시간을 사용합니다.

![](http://yuml.me/7c1b5d75)

## 머신 러닝의 종류

![](http://quantdare.com/wp-content/uploads/2016/03/MLAlgorithms-e1456930214606-642x467.png)

## 평가하기

평가를 위해서는 평가를 위한 데이터를 따로 준비해야 합니다. 하지만 데이터를 확보하는데 한계가 있기 때문에 전체 데이터를 일정 부분 남겨두는 방식을 많이 취합니다.

보통 `학습 데이터:테스트 데이터`의 비율을 `7:3` 정도로 사용하는 편입니다.

평가가 적절히 이루어 지려면 학습 데이터 중에 테스트 데이터가 겹치는 것이 있지 않는 것이 좋습니다.

## 회귀 모델

회귀 모델을 사용하는 함수는 대표적으로 `lm`이 있습니다. 이외에 `glm`이나 `rlm` 등이 있습니다. 데이터가 준비되었다면, 모델을 세우고 평가하는 코드가 짧은 편입니다.

```
fit <- lm(y ~ x1 + x2 + x3, data=mydata)
summary(fit)
predict(fit, testData, interval="predict") 
```

## 모델 학습

```
fit <- lm(y ~ x1 + x2 + x3, data=mydata)
```

  - `lm`: linear model의 약어이며 모델을 학습하는 함수입니다.
  - `fit`: 결과를 저장한 데이터 객체로 학습한 모델의 정보를 가지고 있습니다.
     * 결과라는 것이 학습한 모델을 뜻하는 것이지 예측 결과를 의미하는 것이 아닙니다.
  - `~` : 첫번째 인자인 식을 작성하는 방식으로 `~`을 사용합니다.
  - `data`: 사용하는 데이터를 지정합니다. 지정하면 앞에 식을 작성할 때 컬럼 이름만 으로 작성하는 등의 문법적 혜택이 있습니다.

```
fit <- lm(y ~ . , data=mydata)
```
  - `.` : mydata의 컬럼 중에 y를 제외하고 모두 x로 사용하고 싶으면 남은 변수 모두라는 의미로 사용합니다.

## 데이터

일반적인 회귀 모델은 입력 변수들을 바탕으로 연속형 숫자가 결과로 나오는 모델입니다. 그렇기 때문에 Y(=종속변수=결과=정답=라벨=아웃풋=...)에 해당하는 변수가 `numeric`이어야 합니다.

X(=독립변수=데이터=요인=특성=인풋-=...)에 해당하는 변수 또한 `numeric`이어야 합니다. 하지만 `dummy` 변수라는 방법으로 명목형 데이터를 사용할 수 있습니다.

## 더미 변수란

[더미 변수](https://cran.r-project.org/web/packages/googlesheets/vignettes/basic-usage.html)란 `0`과 `1`을 값으로 가지는 변수를 의미합니다. 회귀 모델에서 명목형 데이터를 X로 사용하는 방법은 하나의 명목형 데이터를 여러 더미 변수로 변경하여 사용하는 것입니다. 

회귀식에서 더미 변수의 의미는 0일 때 해당 변수가 적용되지 않음, 1일때 적용됨을 뜻합니다.

`R`에서는 명목형 데이터를 `character`로 두지 않고 `factor`를 만듬으로써 쉽게 적용할 수 있습니다.

## 실습




## 군집 알고리즘

## 연관 분석

## 실습

# 과제

